# ファームウェア

LisMはZMKファームウェアを使用しています。  
キーマップの変更やモジュールの構成変更には、ファームウェアの書き換えが必要です。

## ファームウェアの考え方

ZMK(Zephyr)の設計思想に基づき、`個人設定`と`ハードウェア構成`が分離されています。

- **[zmk-keyboards-LisM (ハードウェア構成)]({{firmware_keyboard_url}}){:target="_blank"}**  
  キーボードのハードウェアを構成するファームウェアです。  
  通常、こちらを編集する必要はありません。
- **[zmk-config-LisM (個人設定)]({{firmware_config_url}}){:target="_blank"}**  
  キーマップやコンボなど、個人の好みに合わせて設定するファイルです。  
  キーマップを変更したい場合は、こちらの`config/lism.keymap`を編集します。

## ファームウェアの書き込み手順

ファームウェアを書き換えるには、キーボードを「ブートローダーモード」で起動し、PCに接続する必要があります。

1. **USBケーブルでPCと接続する**
   
2.  **ブートローダーモードで起動する**  
    以下のいずれかの方法でブートローダーモードにしてください。  
    - 反対側のキーボードの外側1番下のキーを押しながら、ブートローダーモードにしたい側のキーボードの外側1番下キーを押します。
    - キーボード底面のリセットボタンを**リセットボタンを素早く2回押し**ます。
    - XIAOの**リセットボタンを素早く2回押し**ます。

    成功すると、PC上にUSBドライブとして認識されます。

3.  **ファームウェアファイルをコピーする**
    - `.uf2` 形式のファームウェアファイルを、表示されたUSBドライブにドラッグ＆ドロップでコピーします。
    - コピーが完了すると、キーボードは自動的に再起動します。


## モジュール構成とファームウェア

左右のキーボードには、それぞれ対応したファームウェアを書き込む必要があります。  
ファームウェアはモジュールの組み合わせによって異なります。

| 左側モジュール | 右側モジュール | 左手側ファームウェア | 右手側ファームウェア |
| :--- | :--- | :--- | :--- |
| トラックボール       | 非トラックボール[^1] | `lism_left_trackball.uf2` | `lism_right_non_trackball.uf2` |
| 非トラックボール[^1] | トラックボール       | `lism_left_non_trackball.uf2` | `lism_right_trackball.uf2` |
| 非トラックボール[^1] | 非トラックボール[^1] | `lism_left_non_trackball.uf2` | `lism_right_non_trackball.uf2` |
| トラックボール       | トラックボール       | `lism_left_trackball.uf2` | `lism_right_trackball.uf2` |

[^1]:「非トラックボール」モジュールには以下が含まれます。  
    - 水平ロータリーエンコーダー  
    - 垂直ロータリーエンコーダー  
    - キースイッチ

## キーマップの変更方法

キーマップの変更は、ご自身のGitHubアカウントで `個人設定`リポジトリをフォークして行います。

??? warning "キーマップの変更はGitHubアカウントが必要です"

    以下の動画が参考になります。
    <a href="https://www.youtube.com/watch?v=vXpV9jgRB1M&t=440s" target="_blank" rel="noopener">
      <img src="https://img.youtube.com/vi/vXpV9jgRB1M/maxresdefault.jpg" alt="YouTube Video Thumbnail" style="width:100%;" />
    </a>

1. [zmk-config-LisM]({{firmware_config_url}}){:target="_blank"}をフォークします。
2. フォークしたリポジトリの「Actions」タブで、ワークフローを有効化（Enable Actions）します。
3. `config/lism.keymap` ファイルをオンラインで編集し、変更をコミットします。
4. コミット後、自動的にファームウェアのビルドが開始されます。
5. ビルドが完了したら、Actionsのページから成果物（firmware.zip）をダウンロードします。
6. zipファイルを解凍し、中の `.uf2` ファイルを上記の手順でキーボードに書き込みます。
